<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<title>{{title }}</title>
	<link rel="stylesheet" href="/css/style.css">
	{{#if ENV_DEVELOPMENT}}
	<script src="http://localhost:35729/livereload.js"></script>
	{{/if}}
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
	<script src="/socket.io/socket.io.js"></script>
	<script>
	$(document).ready(function(){
		var config = {
			entryKey: 'Enter',
			isbnInput: $('input#isbn'),
		};

		var socket = io('https://libbie.azurewebsites.net');
		socket.on('error', function (data) {
			console.log("Server sent error: ", error);
		});

		socket.on('isbnIdentified', function isbnIdentified(data) {
			console.log("ISBN Identified: ", data);

			// TODO: Should use handlebars
			$('.addedIsbn.' + data.isbn + ' .title').text(data.title);
		});

		config.isbnInput.keypress(function keypressHandler(event) {
			if (event.key === config.entryKey) {
				config.isbnInput.focus();

				var isbn = config.isbnInput.val();
				if (!validateIsbn(isbn)) {
					alert("Invalid isbn!");
					return;
				}

				console.log("Sending addIsbn request...");
				socket.emit('addIsbn', {
					isbn: isbn,
				});
			}
		});

		function validateIsbn(isbn) {
			return true;
		}
	});
	</script>
</head>
<body>


	{{{body}}}


</body>
</html>
